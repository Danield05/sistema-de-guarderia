<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug JavaScript - Sistema Guarder√≠a</title>
    
    <!-- jQuery CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Estilos Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üîß Debug JavaScript - Sistema de Guarder√≠a</h1>
        
        <div class="debug-section">
            <h3>üìã Verificaciones del Sistema</h3>
            <div id="results"></div>
        </div>
        
        <div class="debug-section">
            <h3>üß™ Pruebas AJAX</h3>
            <button class="btn btn-primary mr-2" onclick="testDatabaseConnection()">Probar Conexi√≥n DB</button>
            <button class="btn btn-secondary mr-2" onclick="testNinosAJAX()">Probar AJAX Ni√±os</button>
            <button class="btn btn-success mr-2" onclick="testDataTables()">Probar DataTables</button>
            <button class="btn btn-warning mr-2" onclick="testjQuery()">Probar jQuery</button>
            <button class="btn btn-info mr-2" onclick="testCSSLoading()">Probar CSS</button>
        </div>
        
        <div class="debug-section">
            <h3>üìä Estado del Sistema</h3>
            <div id="system-status"></div>
        </div>
    </div>

    <script>
        let debugDiv = document.getElementById('results');
        let statusDiv = document.getElementById('system-status');
        
        function addResult(title, status, message) {
            let div = document.createElement('div');
            div.className = `test-result ${status}`;
            div.innerHTML = `<strong>${title}:</strong> ${message}`;
            debugDiv.appendChild(div);
        }
        
        function updateSystemStatus() {
            let status = `
                <strong>jQuery cargado:</strong> ${typeof jQuery !== 'undefined' ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>Versi√≥n jQuery:</strong> ${typeof jQuery !== 'undefined' ? jQuery.fn.jquery : 'No disponible'}<br>
                <strong>$ definido:</strong> ${typeof $ !== 'undefined' ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>Bootstrap cargado:</strong> ${typeof bootstrap !== 'undefined' ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>DataTables disponible:</strong> ${typeof $.fn.DataTable !== 'undefined' ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>Bootbox disponible:</strong> ${typeof bootbox !== 'undefined' ? '‚úÖ S√≠' : '‚ùå No'}<br>
                <strong>URL actual:</strong> ${window.location.href}<br>
                <strong>Tama√±o de ventana:</strong> ${window.innerWidth}x${window.innerHeight}
            `;
            statusDiv.innerHTML = status;
        }
        
        function testjQuery() {
            try {
                if (typeof $ === 'undefined') {
                    addResult('jQuery', 'error', 'jQuery no est√° cargado');
                } else {
                    addResult('jQuery', 'success', 'jQuery est√° funcionando correctamente - Versi√≥n: ' + $.fn.jquery);
                    
                    // Probar funci√≥n b√°sica
                    $('body').css('background-color', '#f8f9fa');
                    setTimeout(() => {
                        $('body').css('background-color', '');
                        addResult('jQuery DOM', 'success', 'Manipulaci√≥n DOM funciona correctamente');
                    }, 1000);
                }
            } catch (e) {
                addResult('jQuery', 'error', 'Error: ' + e.message);
            }
        }
        
        function testDataTables() {
            try {
                if (typeof $.fn.DataTable === 'undefined') {
                    addResult('DataTables', 'error', 'DataTables no est√° cargado');
                } else {
                    addResult('DataTables', 'success', 'DataTables est√° disponible - Versi√≥n: ' + $.fn.DataTable.version);
                }
            } catch (e) {
                addResult('DataTables', 'error', 'Error: ' + e.message);
            }
        }
        
        function testCSSLoading() {
            try {
                let testDiv = document.createElement('div');
                testDiv.className = 'container';
                testDiv.innerHTML = 'Test CSS';
                document.body.appendChild(testDiv);
                
                let computed = window.getComputedStyle(testDiv);
                if (computed.display !== 'none') {
                    addResult('CSS Bootstrap', 'success', 'Bootstrap CSS se est√° cargando correctamente');
                } else {
                    addResult('CSS Bootstrap', 'warning', 'Bootstrap CSS podr√≠a no estar carg√°ndose');
                }
                document.body.removeChild(testDiv);
            } catch (e) {
                addResult('CSS Bootstrap', 'error', 'Error: ' + e.message);
            }
        }
        
        function testDatabaseConnection() {
            addResult('DB Connection', 'warning', 'Iniciando prueba de conexi√≥n...');
            
            $.ajax({
                url: 'ajax/usuario.php?op=listar',
                method: 'POST',
                dataType: 'json',
                timeout: 10000,
                success: function(data) {
                    if (data.aaData) {
                        addResult('DB Connection', 'success', `Conexi√≥n exitosa - Usuarios encontrados: ${data.iTotalRecords}`);
                    } else {
                        addResult('DB Connection', 'warning', 'Conexi√≥n exitosa pero formato inesperado');
                    }
                },
                error: function(xhr, status, error) {
                    addResult('DB Connection', 'error', `Error: ${status} - ${error}`);
                    console.log('Response:', xhr.responseText);
                }
            });
        }
        
        function testNinosAJAX() {
            addResult('Ni√±os AJAX', 'warning', 'Iniciando prueba AJAX para ni√±os...');
            
            $.ajax({
                url: 'ajax/ninos.php?op=listar',
                method: 'POST',
                dataType: 'json',
                timeout: 10000,
                success: function(data) {
                    if (data.aaData) {
                        addResult('Ni√±os AJAX', 'success', `AJAX ni√±os exitoso - Registros: ${data.iTotalRecords}`);
                    } else {
                        addResult('Ni√±os AJAX', 'warning', 'AJAX ni√±os exitoso pero sin registros');
                    }
                },
                error: function(xhr, status, error) {
                    addResult('Ni√±os AJAX', 'error', `Error: ${status} - ${error}`);
                    console.log('Response:', xhr.responseText);
                }
            });
        }
        
        // Ejecutar verificaciones iniciales cuando la p√°gina carga
        $(document).ready(function() {
            addResult('Inicializaci√≥n', 'success', 'P√°gina cargada correctamente');
            updateSystemStatus();
            
            // Verificar jQuery peri√≥dicamente
            setTimeout(() => {
                testjQuery();
                testDataTables();
                testCSSLoading();
            }, 1000);
        });
        
        // Actualizar estado del sistema cada 5 segundos
        setInterval(updateSystemStatus, 5000);
    </script>
</body>
</html>